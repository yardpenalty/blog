tinymce.PluginManager.add("image",function(n){function r(n,t){function u(n,r){i.parentNode.removeChild(i);t({width:n,height:r})}var i=document.createElement("img"),r;i.onload=function(){u(i.clientWidth,i.clientHeight)};i.onerror=function(){u()};i.src=n;r=i.style;r.visibility="hidden";r.position="fixed";r.bottom=r.left=0;r.width=r.height="auto";document.body.appendChild(i)}function t(t){return function(){var i=n.settings.image_list;typeof i=="string"?tinymce.util.XHR.send({url:i,success:function(n){t(tinymce.util.JSON.parse(n))}}):t(i)}}function i(t){function y(){var i=[{text:"None",value:""}];return tinymce.each(t,function(t){i.push({text:t.text||t.title,value:n.convertURL(t.value||t.url,"src"),menu:t.menu})}),i}function a(n){var r,u,t,i;r=f.find("#width")[0];u=f.find("#height")[0];t=r.value();i=u.value();f.find("#constrain")[0].checked()&&o&&s&&t&&i&&(n.control==r?(i=Math.round(t/o*i),u.value(i)):(t=Math.round(i/s*t),r.value(t)));o=t;s=i}function v(){function r(i){function r(){i.onload=i.onerror=null;n.selection.select(i);n.nodeChanged()}i.onload=function(){t.width||t.height||u.setAttribs(i,{width:i.clientWidth,height:i.clientHeight});r()};i.onerror=r}var t=f.toJSON();t.width===""&&(t.width=null);t.height===""&&(t.height=null);t.style===""&&(t.style=null);t={src:t.src,alt:t.alt,width:t.width,height:t.height,style:t.style};n.undoManager.transact(function(){if(!t.src){i&&(u.remove(i),n.nodeChanged());return}i?u.setAttribs(i,t):(t.id="__mcenew",n.selection.setContent(u.createHTML("img",t)),i=u.get("__mcenew"),u.setAttrib(i,"id",null));r(i)})}function c(n){return n&&(n=n.replace(/px$/,"")),n}function p(){h&&h.value(n.convertURL(this.value(),"src"));r(this.value(),function(n){n.width&&n.height&&(o=n.width,s=n.height,f.find("#width").value(o),f.find("#height").value(s))})}function w(){function r(n){return n.length>0&&/^[0-9]+$/.test(n)&&(n+="px"),n}var t=f.toJSON(),n=u.parseStyle(t.style);u.setAttrib(i,"style","");delete n.margin;n["margin-top"]=n["margin-bottom"]=r(t.vspace);n["margin-left"]=n["margin-right"]=r(t.hspace);n["border-width"]=r(t.border);f.find("#style").value(u.serializeStyle(u.parseStyle(u.serializeStyle(n))))}var f,e={},u=n.dom,i=n.selection.getNode(),o,s,h,l;o=u.getAttrib(i,"width");s=u.getAttrib(i,"height");i.nodeName!="IMG"||i.getAttribute("data-mce-object")?i=null:e={src:u.getAttrib(i,"src"),alt:u.getAttrib(i,"alt"),width:o,height:s};t&&(h={type:"listbox",label:"Image list",values:y(),value:e.src&&n.convertURL(e.src,"src"),onselect:function(n){var t=f.find("#alt");(!t.value()||n.lastControl&&t.value()==n.lastControl.text())&&t.value(n.control.text());f.find("#src").value(n.control.value())},onPostRender:function(){h=this}});l=[{name:"src",type:"filepicker",filetype:"image",label:"Source",autofocus:!0,onchange:p},h,{name:"alt",type:"textbox",label:"Image description"},{type:"container",label:"Dimensions",layout:"flex",direction:"row",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:3,size:3,onchange:a},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:3,size:3,onchange:a},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}];n.settings.image_advtab?(i&&(e.hspace=c(i.style.marginLeft||i.style.marginRight),e.vspace=c(i.style.marginTop||i.style.marginBottom),e.border=c(i.style.borderWidth),e.style=n.dom.serializeStyle(n.dom.parseStyle(n.dom.getAttrib(i,"style")))),f=n.windowManager.open({title:"Insert/edit image",data:e,bodyType:"tabpanel",body:[{title:"General",type:"form",items:l},{title:"Advanced",type:"form",pack:"start",items:[{label:"Style",name:"style",type:"textbox"},{type:"form",layout:"grid",packV:"start",columns:2,padding:0,alignH:["left","right"],defaults:{type:"textbox",maxWidth:50,onchange:w},items:[{label:"Vertical space",name:"vspace"},{label:"Horizontal space",name:"hspace"},{label:"Border",name:"border"}]}]}],onSubmit:v})):f=n.windowManager.open({title:"Insert/edit image",data:e,body:l,onSubmit:v})}n.addButton("image",{icon:"image",tooltip:"Insert/edit image",onclick:t(i),stateSelector:"img:not([data-mce-object])"});n.addMenuItem("image",{icon:"image",text:"Insert image",onclick:t(i),context:"insert",prependToContext:!0})});
/*
//# sourceMappingURL=plugin.min.js.map
*/