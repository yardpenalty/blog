tinymce.PluginManager.add("media",function(n,t){function r(n){return n.indexOf(".mp3")!=-1?"audio/mpeg":n.indexOf(".wav")!=-1?"audio/wav":n.indexOf(".mp4")!=-1?"video/mp4":n.indexOf(".webm")!=-1?"video/webm":n.indexOf(".ogg")!=-1?"video/ogg":n.indexOf(".swf")!=-1?"application/x-shockwave-flash":""}function u(){function o(n){var e,o,i,f;e=t.find("#width")[0];o=t.find("#height")[0];i=e.value();f=o.value();t.find("#constrain")[0].checked()&&r&&u&&i&&f&&(n.control==e?(f=Math.round(i/r*f),o.value(f)):(i=Math.round(f/u*i),e.value(i)));r=i;u=f}var t,r,u,e;e=h(n.selection.getNode());r=e.width;u=e.height;t=n.windowManager.open({title:"Insert/edit video",data:e,bodyType:"tabpanel",body:[{title:"General",type:"form",onShowTab:function(){this.fromJSON(i(this.next().find("#embed").value()))},items:[{name:"source1",type:"filepicker",filetype:"media",size:40,autofocus:!0,label:"Source"},{name:"source2",type:"filepicker",filetype:"media",size:40,label:"Alternative source"},{name:"poster",type:"filepicker",filetype:"image",size:40,label:"Poster"},{type:"container",label:"Dimensions",layout:"flex",align:"center",spacing:5,items:[{name:"width",type:"textbox",maxLength:3,size:3,onchange:o},{type:"label",text:"x"},{name:"height",type:"textbox",maxLength:3,size:3,onchange:o},{name:"constrain",type:"checkbox",checked:!0,text:"Constrain proportions"}]}]},{title:"Embed",type:"panel",layout:"flex",direction:"column",align:"stretch",padding:10,spacing:10,onShowTab:function(){this.find("#embed").value(f(this.parent().toJSON()))},items:[{type:"label",text:"Paste your embed code below:"},{type:"textbox",flex:1,name:"embed",value:s(),multiline:!0,label:"Source"}]}],onSubmit:function(){n.insertContent(f(this.toJSON()))}})}function s(){var t=n.selection.getNode();if(t.getAttribute("data-mce-object"))return n.selection.getContent()}function f(u){var f="";return!u.source1&&(tinymce.extend(u,i(u.embed)),!u.source1)?"":(u.source1=n.convertURL(u.source1,"source"),u.source2=n.convertURL(u.source2,"source"),u.source1mime=r(u.source1),u.source2mime=r(u.source2),u.poster=n.convertURL(u.poster,"poster"),u.flashPlayerUrl=n.convertURL(t+"/moxieplayer.swf","movie"),u.embed?f=e(u.embed,u,!0):(tinymce.each(o,function(n){var r,t,i;if(r=n.regex.exec(u.source1)){for(i=n.url,t=0;r[t];t++)i=i.replace("$"+t,function(){return r[t]});u.source1=i;u.type=n.type;u.width=n.w;u.height=n.h}}),u.width=u.width||300,u.height=u.height||150,tinymce.each(u,function(t,i){u[i]=n.dom.encode(t)}),u.type=="iframe"?f+='<iframe src="'+u.source1+'" width="'+u.width+'" height="'+u.height+'"><\/iframe>':u.source1mime=="application/x-shockwave-flash"?(f+='<object data="'+u.source1+'" width="'+u.width+'" height="'+u.height+'" type="application/x-shockwave-flash">',u.poster&&(f+='<img src="'+u.poster+'" width="'+u.width+'" height="'+u.height+'" />'),f+="<\/object>"):u.source1mime.indexOf("audio")!=-1?n.settings.audio_template_callback?f=n.settings.audio_template_callback(u):f+='<audio controls="controls" src="'+u.source1+'">'+(u.source2?'\n<source src="'+u.source2+'"'+(u.source2mime?' type="'+u.source2mime+'"':"")+" />\n":"")+"<\/audio>":f=n.settings.video_template_callback?n.settings.video_template_callback(u):'<video width="'+u.width+'" height="'+u.height+'"'+(u.poster?' poster="'+u.poster+'"':"")+' controls="controls">\n<source src="'+u.source1+'"'+(u.source1mime?' type="'+u.source1mime+'"':"")+" />\n"+(u.source2?'<source src="'+u.source2+'"'+(u.source2mime?' type="'+u.source2mime+'"':"")+" />\n":"")+"<\/video>"),f)}function i(n){var t={};return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:"script,noscript",start:function(n,i){t.source1||n!="param"||(t.source1=i.map.movie);(n=="iframe"||n=="object"||n=="embed"||n=="video"||n=="audio")&&(t=tinymce.extend(i.map,t));n=="source"&&(t.source1?t.source2||(t.source2=i.map.src):t.source1=i.map.src);n!="img"||t.poster||(t.poster=i.map.src)}}).parse(n),t.source1=t.source1||t.src||t.data,t.source2=t.source2||"",t.poster=t.poster||"",t}function h(t){return t.getAttribute("data-mce-object")?i(n.serializer.serialize(t,{selection:!0})):{}}function e(n,t,i){function u(n,t){var i,u,r,f;for(i in t)if(r=""+t[i],n.map[i])for(u=n.length;u--;)f=n[u],f.name==i&&(r?(n.map[i]=r,f.value=r):(delete n.map[i],n.splice(u,1)));else r&&(n.push({name:i,value:r}),n.map[i]=r)}var r=new tinymce.html.Writer,f=0,e;return new tinymce.html.SaxParser({validate:!1,allow_conditional_comments:!0,special:"script,noscript",comment:function(n){r.comment(n)},cdata:function(n){r.cdata(n)},text:function(n,t){r.text(n,t)},start:function(n,o,s){switch(n){case"video":case"object":case"embed":case"img":case"iframe":u(o,{width:t.width,height:t.height})}if(i)switch(n){case"video":u(o,{poster:t.poster,src:""});t.source2&&u(o,{src:""});break;case"iframe":u(o,{src:t.source1});break;case"source":if(f++,f<=2&&(u(o,{src:t["source"+f],type:t["source"+f+"mime"]}),!t["source"+f]))return;break;case"img":if(!t.poster)return;e=!0}r.start(n,o,s)},end:function(n){var o,s,h;if(n=="video"&&i)for(o=1;o<=2;o++)t["source"+o]&&(s=[],s.map={},f<o&&(u(s,{src:t["source"+o],type:t["source"+o+"mime"]}),r.start("source",s,!0)));t.poster&&n=="object"&&i&&!e&&(h=[],h.map={},u(h,{src:t.poster,width:t.width,height:t.height}),r.start("img",h,!0));r.end(n)}},new tinymce.html.Schema({})).parse(n),r.getContent()}var o=[{regex:/youtu\.be\/([a-z1-9.-_]+)/,type:"iframe",w:425,h:350,url:"http://www.youtube.com/embed/$1"},{regex:/youtube\.com(.+)v=([^&]+)/,type:"iframe",w:425,h:350,url:"http://www.youtube.com/embed/$2"},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"http://player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc"},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'http://maps.google.com/maps/ms?msid=$2&output=embed"'}];n.on("ResolveName",function(n){var t;n.target.nodeType==1&&(t=n.target.getAttribute("data-mce-object"))&&(n.name=t)});n.on("preInit",function(){var i=n.schema.getSpecialElements(),t;tinymce.each("video audio iframe object".split(" "),function(n){i[n]=new RegExp("<\/"+n+"[^>]*>","gi")});n.schema.addValidElements("object[id|style|width|height|classid|codebase|*],embed[id|style|width|height|type|src|*],video[*],audio[*]");t=n.schema.getBoolAttrs();tinymce.each("webkitallowfullscreen mozallowfullscreen allowfullscreen".split(" "),function(n){t[n]={}});n.parser.addNodeFilter("iframe,video,audio,object,embed",function(t,i){for(var c=t.length,e,r,f,u,o,s,h;c--;){for(r=t[c],f=new tinymce.html.Node("img",1),f.shortEnded=!0,s=r.attributes,e=s.length;e--;)u=s[e].name,o=s[e].value,u!=="width"&&u!=="height"&&u!=="style"&&((u=="data"||u=="src")&&(o=n.convertURL(o,u)),f.attr("data-mce-p-"+u,o));h=r.firstChild&&r.firstChild.value;h&&(f.attr("data-mce-html",escape(h)),f.firstChild=null);f.attr({width:r.attr("width")||"300",height:r.attr("height")||(i=="audio"?"30":"150"),style:r.attr("style"),src:tinymce.Env.transparentSrc,"data-mce-object":i,"class":"mce-object mce-object-"+i});r.replace(f)}});n.serializer.addAttributeFilter("data-mce-object",function(n,t){for(var h=n.length,i,r,u,f,o,e,s;h--;){for(i=n[h],r=new tinymce.html.Node(i.attr(t),1),i.attr(t)!="audio"&&r.attr({width:i.attr("width"),height:i.attr("height")}),r.attr({style:i.attr("style")}),f=i.attributes,u=f.length;u--;)s=f[u].name,s.indexOf("data-mce-p-")===0&&r.attr(s.substr(11),f[u].value);o=i.attr("data-mce-html");o&&(e=new tinymce.html.Node("#text",3),e.raw=!0,e.value=unescape(o),r.append(e));i.replace(r)}})});n.on("ObjectSelected",function(n){n.target.getAttribute("data-mce-object")=="audio"&&n.preventDefault()});n.on("objectResized",function(n){var i=n.target,t;i.getAttribute("data-mce-object")&&(t=i.getAttribute("data-mce-html"),t&&(t=unescape(t),i.setAttribute("data-mce-html",escape(e(t,{width:n.width,height:n.height})))))});n.addButton("media",{tooltip:"Insert/edit video",onclick:u,stateSelector:"img[data-mce-object=video]"});n.addMenuItem("media",{icon:"media",text:"Insert video",onclick:u,context:"insert",prependToContext:!0})});
/*
//# sourceMappingURL=plugin.min.js.map
*/